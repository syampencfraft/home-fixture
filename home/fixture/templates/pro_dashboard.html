{% extends 'base.html' %}

{% block content %}
<div class="row align-items-center mb-5">
    <div class="col-md-6">
        <h1 class="fw-bold m-0">Professional <span class="text-gradient">Dashboard</span></h1>
        <p class="text-muted">Welcome back, {{ user.username }}! Here's your performance summary.</p>
    </div>
    <div class="col-md-6 text-md-end">
        <a href="{% url 'professional_bookings' %}" class="btn btn-premium rounded-pill px-4">
            <i class="bi bi-calendar-check me-2"></i>My Requests
        </a>
    </div>
</div>

<div class="row g-4 mb-5">
    <!-- Profile Overview Card -->
    <div class="col-md-6 col-lg-4">
        <div class="glass-card h-100 p-4">
            <h5 class="fw-bold mb-4 text-info">
                <i class="bi bi-person-circle me-2"></i>Your Profile
            </h5>
            {% if profile %}
            <div class="mb-3">
                <div class="smaller text-muted mb-1">Category</div>
                <div class="fw-bold">{{ profile.category.name|default:"Not Set" }}</div>
            </div>
            <div class="mb-3">
                <div class="smaller text-muted mb-1">Experience</div>
                <div class="fw-bold">{{ profile.experience_years }} Years</div>
            </div>
            <div>
                <div class="smaller text-muted mb-1">Status</div>
                <span
                    class="badge {% if profile.is_verified %}bg-success{% else %}bg-warning text-dark{% endif %} bg-opacity-20 text-{% if profile.is_verified %}success{% else %}warning{% endif %} border border-white border-opacity-10">
                    {% if profile.is_verified %}Verified{% else %}Pending Verification{% endif %}
                </span>
            </div>
            {% else %}
            <div class="alert alert-warning bg-transparent border-warning border-opacity-20 text-warning small">
                Please complete your professional profile setup.
            </div>
            {% endif %}
            <a href="{% url 'update_profile' %}" class="btn btn-outline-light btn-sm w-100 rounded-pill mt-4">Edit
                Profile</a>
        </div>
    </div>

    <!-- Stats Card -->
    <div class="col-md-6 col-lg-4">
        <div class="glass-card h-100 p-4 text-center">
            <h5 class="fw-bold mb-4 text-success">
                <i class="bi bi-shield-check me-2"></i>Safety Score
            </h5>
            <div class="display-3 fw-bold text-gradient mb-2">{{ profile.safety_score|default:"0.0" }}</div>
            <p class="text-muted small">Based on reviews and performance</p>
            <div class="mt-4 pt-3 border-top border-white border-opacity-10 d-flex justify-content-around">
                <div>
                    <div class="fw-bold">{{ profile.total_jobs|default:"0" }}</div>
                    <div class="smaller text-muted">Total Jobs</div>
                </div>
                <div>
                    <div class="fw-bold">{{ profile.rehire_percentage|default:"0" }}%</div>
                    <div class="smaller text-muted">Rehire Rate</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Requests Section -->
<div class="glass-card p-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="fw-bold m-0"><i class="bi bi-bell-fill me-2 text-warning"></i> Recent <span
                class="text-gradient">Requests</span></h4>
        <a href="{% url 'professional_bookings' %}" class="btn btn-link btn-sm text-info text-decoration-none">View
            All</a>
    </div>

    <div class="table-responsive">
        <table class="table table-dark table-hover align-middle border-white border-opacity-10 mb-0">
            <thead class="text-muted smaller fw-bold text-uppercase">
                <tr>
                    <th class="border-0">Job #</th>
                    <th class="border-0">Customer</th>
                    <th class="border-0">Service</th>
                    <th class="border-0">Date</th>
                    <th class="border-0">Status</th>
                    <th class="border-0 text-end">Action</th>
                </tr>
            </thead>
            <tbody>
                {% for booking in recent_bookings %}
                <tr>
                    <td class="fw-bold">#{{ booking.id }}</td>
                    <td>{{ booking.customer.username }}</td>
                    <td>{{ booking.service.name }}</td>
                    <td>{{ booking.booking_date|date:"M j, Y" }}</td>
                    <td>
                        <span
                            class="badge {% if booking.status == 'PENDING' %}bg-warning text-dark{% elif booking.status == 'CONFIRMED' %}bg-info{% elif booking.status == 'PROCESSING' %}bg-info text-dark{% elif booking.status == 'COMPLETED' %}bg-success{% else %}bg-danger{% endif %} bg-opacity-10 text-{% if booking.status == 'PENDING' %}warning{% elif booking.status == 'CONFIRMED' %}info{% elif booking.status == 'PROCESSING' %}dark{% elif booking.status == 'COMPLETED' %}success{% else %}danger{% endif %} border border-white border-opacity-5">
                            {{ booking.status }}
                        </span>
                    </td>
                    <td class="text-end">
                        <a href="{% url 'job_details' booking.id %}"
                            class="btn btn-outline-light btn-sm rounded-pill px-3">Details</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" class="text-center py-4 text-muted">No recent booking requests found.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}